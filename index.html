<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Lecteur Audio Avanc√©</title>
  <script src="https://unpkg.com/tone@latest/build/Tone.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="player">
    <h2>üéß Lecteur Audio Avanc√©</h2>

    <label for="trackSelect">Choisir un fichier :</label>
    <select id="trackSelect">
      <option value="audio/LecÃßon 5-Let's groove-Arnaud Martin.mp3">Le√ßon 5 ‚Äì Let's Groove</option>
      <option value="audio/LecÃßon 9-Chaise longue.m4a">Le√ßon 9 ‚Äì Chaise Longue</option>
    </select>

    <button id="playPause">‚ñ∂Ô∏è Lecture</button>

    <label>Vitesse : <span id="speedVal">1.00√ó</span></label>
    <input id="speed" type="range" min="0.5" max="2" step="0.05" value="1">

    <label>Hauteur : <span id="pitchVal">0</span> demi-ton(s)</label>
    <input id="pitch" type="range" min="-12" max="12" step="1" value="0">
  </div>

<script>
let player, pitchShift;
let isPlaying = false;

function loadTrack(src) {
  if (player) player.dispose();
  if (pitchShift) pitchShift.dispose();
  pitchShift = new Tone.PitchShift({ pitch: 0 }).toDestination();
  player = new Tone.Player(src).connect(pitchShift);
  player.playbackRate = 1;
}

const selector = document.getElementById("trackSelect");
loadTrack(selector.value);

selector.addEventListener("change", () => loadTrack(selector.value));

document.getElementById("playPause").addEventListener("click", async () => {
  await Tone.start();
  if (!isPlaying) {
    player.start();
    isPlaying = true;
    playPause.textContent = "‚è∏ Pause";
  } else {
    player.stop();
    isPlaying = false;
    playPause.textContent = "‚ñ∂Ô∏è Lecture";
  }
});

document.getElementById("speed").addEventListener("input", e => {
  let v = parseFloat(e.target.value);
  player.playbackRate = v;
  speedVal.textContent = v.toFixed(2) + "√ó";
});

document.getElementById("pitch").addEventListener("input", e => {
  let p = parseInt(e.target.value);
  pitchShift.pitch = p;
  pitchVal.textContent = p;
});
</script>
</body>
</html>
